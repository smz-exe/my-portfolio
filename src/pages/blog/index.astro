---
import Layout from '@/layouts/Layout.astro';
import FormattedDate from '@/components/blog/FormattedDate.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .filter((post) => post.data.state !== 'draft')
  .sort((a, b) => b.data.publishedAt.valueOf() - a.data.publishedAt.valueOf());
---

<Layout title="Blog_Index | System Logs">
  <section class="container mx-auto max-w-4xl px-6 py-20">
    <a
      href="/"
      class="group mb-8 inline-flex items-center gap-2 font-mono text-sm text-neutral-500 transition-colors hover:text-accent"
      aria-label="Back to home"
    >
      <span class="transition-transform group-hover:-translate-x-1">&lt;</span>
      cd ..
    </a>
    <div class="mb-8 border-b border-neutral-800 pb-4 font-mono text-sm md:text-base">
      <div class="flex flex-col gap-2 text-muted-foreground">
        <span class="block">
          <span class="text-neutral-400">root@portfolio</span>:<span class="text-neutral-500"
            >~/content/blog</span
          >$ ls -lt
          <span class="ml-1 inline-block animate-blink text-neutral-400">_</span>
        </span>
        <span class="block text-neutral-600">
          total {posts.length} files found...
        </span>
      </div>
    </div>
    <ul class="space-1 flex flex-col">
      <li
        class="hidden items-center gap-4 px-4 py-2 font-mono text-xs tracking-wider text-neutral-600 uppercase md:flex"
      >
        <span class="w-32">Date</span>
        <span class="flex-1">Filename</span>
      </li>

      {
        posts.map((post) => (
          <li>
            <a href={`/blog/${post.slug}`} class="group block">
              <div class="relative flex flex-col gap-1 rounded-none border border-transparent py-3 transition-all duration-200 hover:border-neutral-800 hover:bg-neutral-900 md:flex-row md:items-center md:gap-4 md:py-2">
                <span class="absolute top-0 left-0 h-full w-0.5 bg-primary opacity-0 transition-opacity group-hover:opacity-100" />

                <div class="w-full shrink-0 font-mono text-sm text-neutral-500 md:w-32 md:text-xs">
                  <FormattedDate date={post.data.publishedAt} />
                </div>

                <div class="flex min-w-0 flex-1 items-center gap-2">
                  <span class="font-mono text-neutral-600 md:hidden">├─</span>
                  <h3 class="truncate font-sans text-base font-medium text-neutral-300 transition-colors group-hover:text-neutral-100 md:text-sm">
                    {post.data.title}
                  </h3>
                </div>

                <div class="flex items-center gap-2">
                  <span class="font-mono text-neutral-600 md:hidden">└─</span>
                  <div class="flex gap-2">
                    {post.data.tags.map((tag) => (
                      <span class="border border-neutral-800 px-1 font-mono text-[10px] text-neutral-600 transition-colors group-hover:border-neutral-600 group-hover:text-neutral-400">
                        {tag}
                      </span>
                    ))}
                  </div>
                </div>
              </div>
            </a>
          </li>
        ))
      }
    </ul>

    {
      posts.length === 0 && (
        <div class="py-20 text-center font-mono text-neutral-600">
          <span class="text-red-500">Error 404:</span> Directory is empty.
        </div>
      )
    }
  </section>
</Layout>
